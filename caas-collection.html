<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../caas-crud-behavior/caas-crud-behavior.html">
<link rel="import" href="../caas-document/caas-document.html">

<!--
`caas-collection`


@demo demo/index.html 
-->

<dom-module id="caas-collection">
  <template>

      <iron-ajax
        id="readDocuments"
        headers="[[_requestHeaders]]"
        url="[[apiEndpoint]]/[[route]]"
        method="GET"
        last-response="{{documents}}"
        debounce-duration="[[debounceDuration]]"
        auto="[[autoRead]]"
        loading="{{reading}}"
        on-response="_handleReadResponse"
        on-error="_handleReadResponseError"
      ></iron-ajax>

      <template is="dom-repeat" items="{{documents}}" as="document">
        <caas-document
          api-endpoint="[[apiEndpoint]]"
          access-token="[[accessToken]]"
          auth="[[auth]]"
          route="[[apiEndpoint]]/[[route]]/[[document.id]]"
          debounce-duration="[[debounceDuration]]"
          document="{{document}}"
        ></caas-document>
      </template>

  </template>
  <script>
    Polymer({

      is: 'caas-collection',
      behaviors: [CaasCrudBehavior],

      properties: {

        /**
        * The documents array
        */
        documents: {
          type: Array,
          value: [],
          notify: true
        },

      },

      read: function() {
        this._sendAjaxRequest('read');
      },

      updateItem: function(index) {
        var caasDoc = this.querySelectorAll('caas-document')[index];
        caasDoc.notifyProperties();
      }

    });
  </script>
</dom-module>